
version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 20
    commands:
      - echo "Using Node $(node --version) and npm $(npm --version)"
      - npm install -g npm@latest   # ensures latest npm version

  pre_build:
    commands:
      - echo "Installing backend dependencies..."
      - cd backend && npm install && cd ..
      - echo "Installing frontend dependencies..."
      - cd frontend && npm install && cd ..

  build:
    commands:
      - echo "Building frontend..."
      - cd frontend
      - CI=false npm run build    # prevents CI treating warnings as errors
      - cd ..

  post_build:
    commands:
      - echo "Build completed successfully."

artifacts:
  files:
    - '**/*'
  secondary-artifacts:
    frontend:
      base-directory: frontend/build
      files:
        - '**/*'
    backend:
      base-directory: backend
      files:
        - '**/*'

